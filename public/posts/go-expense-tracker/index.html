<!doctype html><html lang=en dir=auto><head><script src="/personal-blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=personal-blog/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CRUD Operations with Go | Chase's Blog</title>
<meta name=keywords content="HTTP,Go,CRUD,REST"><meta name=description content="Writing a simple REST API using Go."><meta name=author content="Chase"><link rel=canonical href=http://localhost:1313/personal-blog/posts/go-expense-tracker/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/personal-blog/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/personal-blog/static/icon.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/personal-blog/posts/go-expense-tracker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/personal-blog/posts/go-expense-tracker/"><meta property="og:site_name" content="Chase's Blog"><meta property="og:title" content="CRUD Operations with Go"><meta property="og:description" content="Writing a simple REST API using Go."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-17T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-17T00:00:00+00:00"><meta property="article:tag" content="HTTP"><meta property="article:tag" content="Go"><meta property="article:tag" content="CRUD"><meta property="article:tag" content="REST"><meta property="og:image" content="http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover.jpg"><meta name=twitter:title content="CRUD Operations with Go"><meta name=twitter:description content="Writing a simple REST API using Go."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/personal-blog/posts/"},{"@type":"ListItem","position":2,"name":"CRUD Operations with Go","item":"http://localhost:1313/personal-blog/posts/go-expense-tracker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CRUD Operations with Go","name":"CRUD Operations with Go","description":"Writing a simple REST API using Go.","keywords":["HTTP","Go","CRUD","REST"],"articleBody":"Introduction In our last article, we saw how to set up a simple OAuth2 Password Grant flow for our application. In this article, we will go through and implement some of the remaining CRUD operations listed in the roadmap.sh project.\nRefactors Before we get started, let‚Äôs refactor the ValidateToken code from last week. Let‚Äôs rewrite it to write an HTTP status code anytime we run into validation issues instead of our handlers dealing with the errors.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func ValidateToken(w http.ResponseWriter, r *http.Request) string { jwtSecret, secretSet := os.LookupEnv(\"JWT_SECRET\") if !secretSet { http.Error(w, \"JWT_SECRET not set\", http.StatusInternalServerError) return \"\" } auth := r.Header.Get(\"Authorization\") if auth == \"\" { http.Error(w, \"token not set\", http.StatusUnauthorized) return \"\" } token := strings.Split(auth, \" \") if token[0] != \"Bearer\" { http.Error(w, \"token not set\", http.StatusUnauthorized) return \"\" } if len(token) != 2 { http.Error(w, \"token not set\", http.StatusUnauthorized) return \"\" } And then we can rewrite our validate GET /validate handler inside the SecurityRoutes function of security.go as follows\n1 2 3 4 5 http.HandleFunc(\"GET /validate\", func(w http.ResponseWriter, r *http.Request) { if username := ValidateToken(w, r); username != \"\" { fmt.Fprint(w, username) } }) Design The project calls out that we should be able to peform the following CRUD operations:\nCreate a new user Generate and validate JWTS Create an expense Delete an expense Update an expense List and filter expenses In addition, we need to categorize the expense. I will choose to use the following\nHousing Utilities Insurance Financing Groceries Medical Entertainment Travel Other Defining Our Expense Schema And Queries We will need to create a new table for our expenses. Since we will be using foriegn keys and sqlite does not enforce foreign keys by default, we will need to modify the setup function in our main.go as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func setup() (context.Context, *database.Queries, error) { ctx := context.Background() dbfilename, envset := os.LookupEnv(\"DATABASE_FILE\") if !envset { return nil, \u0026database.Queries{}, errors.New(\"DATABASE_FILE env variable not set\") } db, err := sql.Open(\"sqlite3\", dbfilename) db.ExecContext(ctx, \"PRAGMA foreign_keys = ON;\", nil) if err != nil { return nil, \u0026database.Queries{}, err } queries := database.New(db) return ctx, queries, nil } The PRAGMA command is used to enable foreign keys.\nThen we will create two new tables, one for the expenses and another for the categories.\nFirst let‚Äôs rollback our database from scratch, again since we only have test users that do not need to be saved.\n1 2 3 ~\u003edbmate rollback Rolling back: 20250217170014_create-users.sql Rolled back: 20250217170014_create-users.sql in 3.548604ms Now let‚Äôs modify our create-users.sql file as follows\n1 2 3 4 5 6 7 8 9 -- migrate:up create table users ( name text primary key, salt blob not null, hashpassword blob not null ); -- migrate:down drop table users; Here I removed the id as primary key and made the name the primary key instead. Since our JWT is based on the username, we will use the username as the primary key.\nNow let‚Äôs create our create-expense.sql file as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 -- migrate:up create table categories ( category text primary key ); insert into categories (category) values ('Housing'), ('Utilities'), ('Insurance'), ('Financing '), ('Groceries'), ('Medical'), ('Entertainment'), ('Travel'), ('Other'); create table expenses ( id integer primary key, user text references users(name) not null, description text not null, category text references categories(category) not null, amount decimal not null, created_date date not null default current_date ); -- migrate:down drop table expenses; drop table categories; Here we created a new table for the categories and a new table for the expenses. Let‚Äôs run the migrations\n1 2 3 4 5 6 ~/Projects/task-manager\u003edbmate up Applying: 20250215170014_create-users.sql Applied: 20250215170014_create-users.sql in 20.391793ms Applying: 20250217135647_create-expenses.sql Applied: 20250217135647_create-expenses.sql in 4.538702ms Writing: ./db/schema.sql Now let‚Äôs write add the following queries to our db/queries.sql file to interface with our new expense table.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 -- name: InsertUser :one insert into users (name, salt, hashpassword) values (?, ?, ?) returning name; -- name: GetUsers :many select * from users; -- name: GetCredentials :one select salt, hashpassword from users where name = ?; -- name: InsertExpense :one insert into expenses (user, category, amount, description) values (?, ?, ?, ?) returning id; -- name: GetExpenses :many select * from expenses where user = ?; -- name: GetExpensesByCategory :many select * from expenses where category = ? and user = ?; -- name: GetExpensesByDate :many select * from expenses where created_date \u003e= ? and user = ?; -- name: GetExpensesByDateAndCategory :many select * from expenses where created_date \u003e= ? and category = ? and user = ?; -- name: DeleteExpense :exec delete from expenses where id = ?; -- name: UpdateExpense :exec update expenses set category = ?, amount = ?, description = ? where id = ?; Then we generate our database code by running\n1 ~/Projects/task-manager\u003esqlc generate And now we can start creating some routes for our expense tracker.\nInserting an Expense Let‚Äôs start by creating the ExpenseRoutes function inside a new file called internal/expense.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 package internal import ( \"context\" \"database/sql\" \"fmt\" \"net/http\" \"strconv\" \"github.com/acswindle/task-manager/database\" ) func ExpenseRoutes(ctx context.Context, queries *database.Queries) { // GET /users http.HandleFunc(\"POST /api/expense\", func(w http.ResponseWriter, r *http.Request) { err := r.ParseForm() if err != nil { http.Error(w, err.Error(), http.StatusBadRequest) return } amount := r.FormValue(\"amount\") description := r.FormValue(\"description\") category := r.FormValue(\"category\") if amount == \"\" || description == \"\" || category == \"\" { http.Error(w, \"amount, description, and category are required\", http.StatusBadRequest) return } amount_f, err := strconv.ParseFloat(amount, 64) if err != nil { http.Error(w, \"invalid amount\", http.StatusBadRequest) return } username := ValidateToken(w, r) if username == \"\" { return } id, err := queries.InsertExpense(ctx, database.InsertExpenseParams{ User: username, Amount: amount_f, Description: description, Category: category, }) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.Header().Set(\"Content-Type\", \"application/json\") w.Write([]byte(\"{\\\"id\\\": \" + strconv.Itoa(int(id)) + \"}\")) }) } There isn‚Äôt much new here that hasn‚Äôt been seen before. We do some basic validation on the input form data and then we utilize our ValidateToken function to ensure that the user is authenticated before they can make a request. The sqlc generated InsertExpense function makes it then simple to insert the expense into the database. Finally, we send a response back to the client with the id of the new expense.\nGetting Expenses Getting by the user‚Äôs expenses is a bit more complex, due to the various ways that we can filter the expenses. Let‚Äôs start by just getting all of the expenses for the user. Let‚Äôs create a new route in our internal/expense.go file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 http.HandleFunc(\"GET /api/expenses\", func(w http.ResponseWriter, r *http.Request) { username := ValidateToken(w, r) if username == \"\" { return } expenses, err := queries.GetExpenses(ctx, username) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } payload, err := json.Marshal(expenses) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.Header().Set(\"Content-Type\", \"application/json\") w.Write(payload) }) So this is fairly simple. We validate the token, get the username, and then use the GetExpenses sqlc generated function to get the expenses for the user.\nTo add a category filtering capability, we could expand it to include some query parameters like so.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 http.HandleFunc(\"GET /api/expenses\", func(w http.ResponseWriter, r *http.Request) { username := ValidateToken(w, r) if username == \"\" { return } // TODO: Add Category Check category := r.URL.Query().Get(\"category\") var payload []byte var expenses []database.Expense var err error if category != \"\" { expenses, err = queries.GetExpensesByCategory(ctx, database.GetExpensesByCategoryParams{ User: username, Category: category, }) } else { expenses, err = queries.GetExpenses(ctx, username) } if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } payload, err = json.Marshal(expenses) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.Header().Set(\"Content-Type\", \"application/json\") w.Write(payload) }) Here we check the case if the category query parameter is set. Notice the todo. If a user does not send a correct category, they will get no expenses. To better help our client, we should in the future check if the category they sent is a valid category first and return an error if it is not.\nNext we add in the GetExpensesByDate and GetExpensesByDateAndCategory functions.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 http.HandleFunc(\"GET /api/expenses\", func(w http.ResponseWriter, r *http.Request) { username := ValidateToken(w, r) if username == \"\" { return } // TODO: Add Category Check category := r.URL.Query().Get(\"category\") date := r.URL.Query().Get(\"date\") var filterDate time.Time var err error if date != \"\" { filterDate, err = time.Parse(\"2006-01-02\", date) if err != nil { http.Error(w, \"invalid date, must be YYYY-MM-DD format\", http.StatusBadRequest) return } } var expenses []database.Expense if category != \"\" \u0026\u0026 date != \"\" { expenses, err = queries.GetExpensesByDateAndCategory(ctx, database.GetExpensesByDateAndCategoryParams{ User: username, Category: category, CreatedDate: filterDate, }) } else if date != \"\" { expenses, err = queries.GetExpensesByDate(ctx, database.GetExpensesByDateParams{ User: username, CreatedDate: filterDate, }) } else if category != \"\" { expenses, err = queries.GetExpensesByCategory(ctx, database.GetExpensesByCategoryParams{ User: username, Category: category, }) } else { expenses, err = queries.GetExpenses(ctx, username) } if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } var payload []byte payload, err = json.Marshal(expenses) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.Header().Set(\"Content-Type\", \"application/json\") w.Write(payload) }) And we now have a way to filter the expenses by date and category. The project leaves several other ways to filter the expenses. I will leave those to you to implement if you wish.\nDeleting Expenses Now lets quickly implement the DELETE /api/expense/:id route inside our internal/expense.go file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 http.HandleFunc(\"DELETE /api/expense/{id}\", func(w http.ResponseWriter, r *http.Request) { idStr := r.PathValue(\"id\") id, err := strconv.ParseInt(idStr, 10, 64) if err != nil { http.Error(w, \"invalid id, must be an integer\", http.StatusBadRequest) return } username := ValidateToken(w, r) if username == \"\" { return } err = queries.DeleteExpense(ctx, id) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.WriteHeader(http.StatusOK) }) This method is again pretty simple. The only new concept we have is the PathValue function. This is a helper function that allows us to get the value of a specific path parameter. It was implement introduced to the net/http package in Go 1.22. Before then you had to import external packages such as gorilla.\nUpdating Expenses Now lets implement the PUT /api/expense/:id route inside our internal/expense.go file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 http.HandleFunc(\"PATCH /api/expense/{id}\", func(w http.ResponseWriter, r *http.Request) { idStr := r.PathValue(\"id\") id, err := strconv.ParseInt(idStr, 10, 64) if err != nil { http.Error(w, \"invalid id, must be an integer\", http.StatusBadRequest) return } username := ValidateToken(w, r) if username == \"\" { return } if err := r.ParseForm(); err != nil { http.Error(w, err.Error(), http.StatusBadRequest) return } amount := r.FormValue(\"amount\") description := r.FormValue(\"description\") category := r.FormValue(\"category\") if amount == \"\" || description == \"\" || category == \"\" { http.Error(w, \"amount, description, and category are required\", http.StatusBadRequest) return } amount_f, err := strconv.ParseFloat(amount, 64) if err != nil { http.Error(w, \"invalid amount\", http.StatusBadRequest) return } err = queries.UpdateExpense(ctx, database.UpdateExpenseParams{ ID: id, Amount: amount_f, Description: description, Category: category, }) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } w.WriteHeader(http.StatusOK) }) This method is again pretty simple, and no new concepts are introduced.\nConclusion Now our expense tracker is complete! We have implemented all of the routes that we need to perform the CRUD operations for expenses. Of course the functionality can still be improved, such as adding more filtering options to the GET /api/expense route. We also still need to implement the GET /api/expense/:id route to get a single expense. In additional, there are times that we are relying on the sqlite database engine to check the validity of the data. We should instead check the validity of the data before we trying save it to the database. This will allow us to provide the client with more useful error messages. If you would try to implement some of these, I encourage you to do so, and let me know if you have any questions.\nThe code for this project up to this point can be found here.\nNext time I will show you how to build our application into a docker container and how to upload it to a docker registry. This will enable us to easily deploy our application to AWS.\nUntil next time! üçª\n","wordCount":"2274","inLanguage":"en","image":"http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover.jpg","datePublished":"2025-02-17T00:00:00Z","dateModified":"2025-02-17T00:00:00Z","author":{"@type":"Person","name":"Chase"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/personal-blog/posts/go-expense-tracker/"},"publisher":{"@type":"Organization","name":"Chase's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/personal-blog/static/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/personal-blog/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/personal-blog/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/personal-blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/personal-blog/>Home</a>&nbsp;¬ª&nbsp;<a href=http://localhost:1313/personal-blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">CRUD Operations with Go</h1><div class=post-meta><span title='2025-02-17 00:00:00 +0000 UTC'>February 17, 2025</span>&nbsp;¬∑&nbsp;11 min&nbsp;¬∑&nbsp;2274 words&nbsp;¬∑&nbsp;Chase&nbsp;|&nbsp;<a href=https://github.com/acswindle/personal-blog/content/posts/go-expense-tracker/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager srcset="http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover_hu_8246c36fe4f13d96.jpg 360w ,http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover_hu_fdeadb318162de5c.jpg 480w ,http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover_hu_3e4a5459737deecd.jpg 720w ,http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover.jpg 960w" sizes="(min-width: 768px) 720px, 100vw" src=http://localhost:1313/personal-blog/posts/go-expense-tracker/api-cover.jpg alt width=960 height=480></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#refactors>Refactors</a></li><li><a href=#design>Design</a></li><li><a href=#defining-our-expense-schema-and-queries>Defining Our Expense Schema And Queries</a></li><li><a href=#inserting-an-expense>Inserting an Expense</a></li><li><a href=#getting-expenses>Getting Expenses</a></li><li><a href=#deleting-expenses>Deleting Expenses</a></li><li><a href=#updating-expenses>Updating Expenses</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>In our <a href=/personal-blog/posts/go-security/>last article</a>,
we saw how to set up a simple OAuth2 Password Grant flow
for our application.
In this article, we will go through and implement some of the remaining
CRUD operations listed in the <a href=https://roadmap.sh/projects/expense-tracker-api>roadmap.sh project</a>.</p><h2 id=refactors>Refactors<a hidden class=anchor aria-hidden=true href=#refactors>#</a></h2><p>Before we get started, let&rsquo;s refactor the <code>ValidateToken</code> code from last week.
Let&rsquo;s rewrite it to write an HTTP status code anytime we run into validation
issues instead of our handlers dealing with the errors.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>jwtSecret</span><span class=p>,</span> <span class=nx>secretSet</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>LookupEnv</span><span class=p>(</span><span class=s>&#34;JWT_SECRET&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>secretSet</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;JWT_SECRET not set&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>auth</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>auth</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;token not set&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>token</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nx>auth</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>token</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=s>&#34;Bearer&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;token not set&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>token</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;token not set&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>And then we can rewrite our validate <code>GET /validate</code> handler inside the <code>SecurityRoutes</code> function
of <code>security.go</code> as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;GET /validate&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>);</span> <span class=nx>username</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprint</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=design>Design<a hidden class=anchor aria-hidden=true href=#design>#</a></h2><p>The project calls out that we should be able to peform the following CRUD operations:</p><ul><li><input checked disabled type=checkbox> Create a new user</li><li><input checked disabled type=checkbox> Generate and validate JWTS</li><li><input disabled type=checkbox> Create an expense</li><li><input disabled type=checkbox> Delete an expense</li><li><input disabled type=checkbox> Update an expense</li><li><input disabled type=checkbox> List and filter expenses</li></ul><p>In addition, we need to categorize the expense. I will choose to
use the following</p><ul><li>Housing</li><li>Utilities</li><li>Insurance</li><li>Financing</li><li>Groceries</li><li>Medical</li><li>Entertainment</li><li>Travel</li><li>Other</li></ul><h2 id=defining-our-expense-schema-and-queries>Defining Our Expense Schema And Queries<a hidden class=anchor aria-hidden=true href=#defining-our-expense-schema-and-queries>#</a></h2><p>We will need to create a new table for our expenses.
Since we will be using foriegn keys and sqlite does
not enforce foreign keys by default, we will need to
modify the <code>setup</code> function in our <code>main.go</code> as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=hl><span class=lnt> 9
</span></span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>setup</span><span class=p>()</span> <span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=o>*</span><span class=nx>database</span><span class=p>.</span><span class=nx>Queries</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>dbfilename</span><span class=p>,</span> <span class=nx>envset</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>LookupEnv</span><span class=p>(</span><span class=s>&#34;DATABASE_FILE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>envset</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>database</span><span class=p>.</span><span class=nx>Queries</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;DATABASE_FILE env variable not set&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sql</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;sqlite3&#34;</span><span class=p>,</span> <span class=nx>dbfilename</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>	<span class=nx>db</span><span class=p>.</span><span class=nf>ExecContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;PRAGMA foreign_keys = ON;&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>database</span><span class=p>.</span><span class=nx>Queries</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>queries</span> <span class=o>:=</span> <span class=nx>database</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>db</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctx</span><span class=p>,</span> <span class=nx>queries</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>PRAGMA</code> command is used to enable foreign keys.</p><p>Then we will create two new tables, one for the expenses and another for the categories.</p><p>First let&rsquo;s rollback our database from scratch, again since we only have test users that
do not need to be saved.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~&gt;dbmate rollback
</span></span><span class=line><span class=cl>Rolling back: 20250217170014_create-users.sql
</span></span><span class=line><span class=cl>Rolled back: 20250217170014_create-users.sql in 3.548604ms
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s modify our <code>create-users.sql</code> file as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=hl><span class=lnt>3
</span></span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- migrate:up
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=n>name</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>salt</span><span class=w> </span><span class=nb>blob</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>hashpassword</span><span class=w> </span><span class=nb>blob</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- migrate:down
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>users</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Here I removed the id as primary key and made the name the primary key instead.
Since our JWT is based on the username, we will use the username as the primary key.</p><p>Now let&rsquo;s create our <code>create-expense.sql</code> file as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- migrate:up
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>category</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=p>(</span><span class=n>category</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Housing&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Utilities&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Insurance&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Financing &#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Groceries&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Medical&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Entertainment&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Travel&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;Other&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>expenses</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>id</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>user</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>description</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>category</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=n>categories</span><span class=p>(</span><span class=n>category</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>amount</span><span class=w> </span><span class=nb>decimal</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>created_date</span><span class=w> </span><span class=nb>date</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=k>current_date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- migrate:down
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>expenses</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>categories</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Here we created a new table for the categories and a new table for the expenses.
Let&rsquo;s run the migrations</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~/Projects/task-manager&gt;dbmate up
</span></span><span class=line><span class=cl>Applying: 20250215170014_create-users.sql
</span></span><span class=line><span class=cl>Applied: 20250215170014_create-users.sql in 20.391793ms
</span></span><span class=line><span class=cl>Applying: 20250217135647_create-expenses.sql
</span></span><span class=line><span class=cl>Applied: 20250217135647_create-expenses.sql in 4.538702ms
</span></span><span class=line><span class=cl>Writing: ./db/schema.sql
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s write add the following queries
to our <code>db/queries.sql</code> file to interface with our new expense table.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=hl><span class=lnt>30
</span></span><span class=hl><span class=lnt>31
</span></span><span class=hl><span class=lnt>32
</span></span><span class=hl><span class=lnt>33
</span></span><span class=hl><span class=lnt>34
</span></span><span class=hl><span class=lnt>35
</span></span><span class=hl><span class=lnt>36
</span></span><span class=hl><span class=lnt>37
</span></span><span class=hl><span class=lnt>38
</span></span><span class=hl><span class=lnt>39
</span></span><span class=hl><span class=lnt>40
</span></span><span class=hl><span class=lnt>41
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- name: InsertUser :one
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>salt</span><span class=p>,</span><span class=w> </span><span class=n>hashpassword</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>returning</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- name: GetUsers :many
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- name: GetCredentials :one
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=n>salt</span><span class=p>,</span><span class=w> </span><span class=n>hashpassword</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: InsertExpense :one
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>expenses</span><span class=w> </span><span class=p>(</span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>description</span><span class=p>)</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=p>)</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=n>returning</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: GetExpenses :many
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: GetExpensesByCategory :many
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: GetExpensesByDate :many
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>created_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: GetExpensesByDateAndCategory :many
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>created_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: DeleteExpense :exec
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=c1>-- name: UpdateExpense :exec
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=k>update</span><span class=w> </span><span class=n>expenses</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Then we generate our database code by running</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~/Projects/task-manager&gt;sqlc generate
</span></span></code></pre></td></tr></table></div></div><p>And now we can start creating some routes for our expense tracker.</p><h2 id=inserting-an-expense>Inserting an Expense<a hidden class=anchor aria-hidden=true href=#inserting-an-expense>#</a></h2><p>Let&rsquo;s start by creating the <code>ExpenseRoutes</code> function inside a new file called <code>internal/expense.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>internal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;database/sql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strconv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/acswindle/task-manager/database&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ExpenseRoutes</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>queries</span> <span class=o>*</span><span class=nx>database</span><span class=p>.</span><span class=nx>Queries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// GET /users</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;POST /api/expense&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>ParseForm</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>amount</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;amount&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>description</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;description&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>category</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;category&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>amount</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=o>||</span> <span class=nx>description</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=o>||</span> <span class=nx>category</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;amount, description, and category are required&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>amount_f</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseFloat</span><span class=p>(</span><span class=nx>amount</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;invalid amount&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>InsertExpense</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>InsertExpenseParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>User</span><span class=p>:</span>        <span class=nx>username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Amount</span><span class=p>:</span>      <span class=nx>amount_f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Description</span><span class=p>:</span> <span class=nx>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Category</span><span class=p>:</span>    <span class=nx>category</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;{\&#34;id\&#34;: &#34;</span> <span class=o>+</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Itoa</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nx>id</span><span class=p>))</span> <span class=o>+</span> <span class=s>&#34;}&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>There isn&rsquo;t much new here that hasn&rsquo;t been seen before.
We do some basic validation on the input form data and then
we utilize our <code>ValidateToken</code> function
to ensure that the user is authenticated before they can make a request.
The sqlc generated <code>InsertExpense</code> function makes it then simple to insert the expense into the database.
Finally, we send a response back to the client with the id of the new expense.</p><h2 id=getting-expenses>Getting Expenses<a hidden class=anchor aria-hidden=true href=#getting-expenses>#</a></h2><p>Getting by the user&rsquo;s expenses is a bit more complex, due to the various
ways that we can filter the expenses. Let&rsquo;s start by just getting all of the
expenses for the user. Let&rsquo;s create a new route in our <code>internal/expense.go</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;GET /api/expenses&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpenses</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>payload</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Marshal</span><span class=p>(</span><span class=nx>expenses</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>So this is fairly simple. We validate the token, get the username, and then
use the <code>GetExpenses</code> sqlc generated function to get the expenses for the user.</p><p>To add a category filtering capability, we could expand it to include some query parameters
like so.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=hl><span class=lnt> 6
</span></span><span class=hl><span class=lnt> 7
</span></span><span class=hl><span class=lnt> 8
</span></span><span class=hl><span class=lnt> 9
</span></span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;GET /api/expenses&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class="line hl"><span class=cl>		<span class=c1>// TODO: Add Category Check</span>
</span></span><span class="line hl"><span class=cl>		<span class=nx>category</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;category&#34;</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>payload</span> <span class=p>[]</span><span class=kt>byte</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>expenses</span> <span class=p>[]</span><span class=nx>database</span><span class=p>.</span><span class=nx>Expense</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>err</span> <span class=kt>error</span>
</span></span><span class="line hl"><span class=cl>		<span class=k>if</span> <span class=nx>category</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpensesByCategory</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>GetExpensesByCategoryParams</span><span class=p>{</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>User</span><span class=p>:</span>     <span class=nx>username</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>Category</span><span class=p>:</span> <span class=nx>category</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>			<span class=p>})</span>
</span></span><span class="line hl"><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpenses</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>username</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>payload</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Marshal</span><span class=p>(</span><span class=nx>expenses</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we check the case if the category query parameter is set. Notice the todo.
If a user does not send a correct category, they will get no expenses. To better
help our client, we should in the future check if the category they sent is a valid category first
and return an error if it is not.</p><p>Next we add in the <code>GetExpensesByDate</code> and <code>GetExpensesByDateAndCategory</code> functions.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=hl><span class=lnt> 9
</span></span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;GET /api/expenses&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// TODO: Add Category Check</span>
</span></span><span class=line><span class=cl>		<span class=nx>category</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;category&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>date</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;date&#34;</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>filterDate</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>err</span> <span class=kt>error</span>
</span></span><span class="line hl"><span class=cl>		<span class=k>if</span> <span class=nx>date</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>			<span class=nx>filterDate</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=s>&#34;2006-01-02&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;invalid date, must be YYYY-MM-DD format&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>				<span class=k>return</span>
</span></span><span class="line hl"><span class=cl>			<span class=p>}</span>
</span></span><span class="line hl"><span class=cl>		<span class=p>}</span>
</span></span><span class="line hl"><span class=cl>		<span class=kd>var</span> <span class=nx>expenses</span> <span class=p>[]</span><span class=nx>database</span><span class=p>.</span><span class=nx>Expense</span>
</span></span><span class="line hl"><span class=cl>		<span class=k>if</span> <span class=nx>category</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>date</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpensesByDateAndCategory</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>GetExpensesByDateAndCategoryParams</span><span class=p>{</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>User</span><span class=p>:</span>        <span class=nx>username</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>Category</span><span class=p>:</span>    <span class=nx>category</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>CreatedDate</span><span class=p>:</span> <span class=nx>filterDate</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>			<span class=p>})</span>
</span></span><span class="line hl"><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>date</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpensesByDate</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>GetExpensesByDateParams</span><span class=p>{</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>User</span><span class=p>:</span>        <span class=nx>username</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>				<span class=nx>CreatedDate</span><span class=p>:</span> <span class=nx>filterDate</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>category</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpensesByCategory</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>GetExpensesByCategoryParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>User</span><span class=p>:</span>     <span class=nx>username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Category</span><span class=p>:</span> <span class=nx>category</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>expenses</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>GetExpenses</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>payload</span> <span class=p>[]</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl>		<span class=nx>payload</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Marshal</span><span class=p>(</span><span class=nx>expenses</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>And we now have a way to filter the expenses by date and category.
The project leaves several other ways to filter the expenses. I will leave those to you to
implement if you wish.</p><h2 id=deleting-expenses>Deleting Expenses<a hidden class=anchor aria-hidden=true href=#deleting-expenses>#</a></h2><p>Now lets quickly implement the <code>DELETE /api/expense/:id</code> route inside our <code>internal/expense.go</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;DELETE /api/expense/{id}&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>idStr</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>PathValue</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseInt</span><span class=p>(</span><span class=nx>idStr</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;invalid id, must be an integer&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>DeleteExpense</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>This method is again pretty simple. The only new concept we have is the <code>PathValue</code> function.
This is a helper function that allows us to get the value of a specific path parameter.
It was implement introduced to the <code>net/http</code> package in Go 1.22. Before then you
had to import external packages such as <a href=https://github.com/gorilla/mux>gorilla</a>.</p><h2 id=updating-expenses>Updating Expenses<a hidden class=anchor aria-hidden=true href=#updating-expenses>#</a></h2><p>Now lets implement the <code>PUT /api/expense/:id</code> route inside our <code>internal/expense.go</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;PATCH /api/expense/{id}&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>idStr</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>PathValue</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseInt</span><span class=p>(</span><span class=nx>idStr</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;invalid id, must be an integer&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span> <span class=o>:=</span> <span class=nf>ValidateToken</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>username</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>ParseForm</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>amount</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;amount&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>description</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;description&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>category</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>FormValue</span><span class=p>(</span><span class=s>&#34;category&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>amount</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=o>||</span> <span class=nx>description</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=o>||</span> <span class=nx>category</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;amount, description, and category are required&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>amount_f</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseFloat</span><span class=p>(</span><span class=nx>amount</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;invalid amount&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=p>=</span> <span class=nx>queries</span><span class=p>.</span><span class=nf>UpdateExpense</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>database</span><span class=p>.</span><span class=nx>UpdateExpenseParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>ID</span><span class=p>:</span>          <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Amount</span><span class=p>:</span>      <span class=nx>amount_f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Description</span><span class=p>:</span> <span class=nx>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Category</span><span class=p>:</span>    <span class=nx>category</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>This method is again pretty simple, and no new concepts are introduced.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Now our expense tracker is complete! We have implemented all of the routes that we need to
perform the CRUD operations for expenses. Of course the functionality can still be improved,
such as adding more filtering options to the <code>GET /api/expense</code> route. We also still need to
implement the <code>GET /api/expense/:id</code> route to get a single expense. In additional, there are
times that we are relying on the sqlite database engine to check the validity of the data.
We should instead check the validity of the data before we trying save it to the database.
This will allow us to provide the client with more useful error messages. If you would try to
implement some of these, I encourage you to do so, and let me know if you have any questions.</p><p>The code for this project up to this point can be found <a href=https://github.com/acswindle/task-manager/tree/expense-crud>here</a>.</p><p>Next time I will show you how to build our application into a docker container and how to
upload it to a docker registry. This will enable us to easily deploy our application to
AWS.</p><p>Until next time! üçª</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/personal-blog/tags/http/>HTTP</a></li><li><a href=http://localhost:1313/personal-blog/tags/go/>Go</a></li><li><a href=http://localhost:1313/personal-blog/tags/crud/>CRUD</a></li><li><a href=http://localhost:1313/personal-blog/tags/rest/>REST</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/personal-blog/posts/go-backend-setup/><span class=title>Next ¬ª</span><br><span>Setting Up A Go Backend</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on x" href="https://x.com/intent/tweet/?text=CRUD%20Operations%20with%20Go&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f&amp;hashtags=HTTP%2cGo%2cCRUD%2cREST"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f&amp;title=CRUD%20Operations%20with%20Go&amp;summary=CRUD%20Operations%20with%20Go&amp;source=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f&title=CRUD%20Operations%20with%20Go"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on whatsapp" href="https://api.whatsapp.com/send?text=CRUD%20Operations%20with%20Go%20-%20http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on telegram" href="https://telegram.me/share/url?text=CRUD%20Operations%20with%20Go&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share CRUD Operations with Go on ycombinator" href="https://news.ycombinator.com/submitlink?t=CRUD%20Operations%20with%20Go&u=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fgo-expense-tracker%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/personal-blog/>Chase's Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>