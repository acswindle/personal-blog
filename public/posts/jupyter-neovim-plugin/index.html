<!doctype html><html lang=en dir=auto><head><script src="/personal-blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=personal-blog/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Creating a Jupyter Plugin for Neovim | Chase's Blog</title>
<meta name=keywords content="Neovim,Jupyter,Plugin,Lua"><meta name=description content="Creating a Jupyter Plugin for Neovim."><meta name=author content="Chase"><link rel=canonical href=http://localhost:1313/personal-blog/posts/jupyter-neovim-plugin/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/personal-blog/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/personal-blog/static/icon.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/personal-blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/personal-blog/posts/jupyter-neovim-plugin/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/personal-blog/posts/jupyter-neovim-plugin/"><meta property="og:site_name" content="Chase's Blog"><meta property="og:title" content="Creating a Jupyter Plugin for Neovim"><meta property="og:description" content="Creating a Jupyter Plugin for Neovim."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-19T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-19T00:00:00+00:00"><meta property="article:tag" content="Neovim"><meta property="article:tag" content="Jupyter"><meta property="article:tag" content="Plugin"><meta property="article:tag" content="Lua"><meta property="og:image" content="http://localhost:1313/personal-blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/personal-blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Creating a Jupyter Plugin for Neovim"><meta name=twitter:description content="Creating a Jupyter Plugin for Neovim."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/personal-blog/posts/"},{"@type":"ListItem","position":2,"name":"Creating a Jupyter Plugin for Neovim","item":"http://localhost:1313/personal-blog/posts/jupyter-neovim-plugin/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating a Jupyter Plugin for Neovim","name":"Creating a Jupyter Plugin for Neovim","description":"Creating a Jupyter Plugin for Neovim.","keywords":["Neovim","Jupyter","Plugin","Lua"],"articleBody":"Introduction I love NeoVim. However, there are times as a data scientist that I really need the interactive experience of what Jupyter provides. I have looked into various plugins for neovim, but none of them seem to work at the level I would prefer. Whenever I find myself in the need of an interactive environment, I end up opening VSCode and using Jupyter interactively from my .py files using the special #%% comment blocks.\nToday, I decided to no longer keep this last thing from keeping me from developing soley in neovim. Time to embark on my first NeoVim plugin!\nRequirements I want to make the requirements for this plugin initially as simple as possible.\nConnect to a Jupyter Server Run the code contained within #%% blocks in the current buffer where the cursor is currently located Display the results in a new buffer and window. Close the connection when the buffer is closed. I realize that this is a very simple plugin, but I want to make it as simple as possible to get started.\nProjet Setup First, lets create a new directory called jupyter-nvim and create the following structure.\nOur /lua/jupyter/init.lua will contain the bulk of our plugin’s code. The /plugin/jupyter.lua contains the code we want neovim to execute on startup. This will mostly be the vim commands we want to associate with the function in our init.lua file.The tests directory will contain some http testing files to test our connection with the Jupyter server and some python files we can test our plugin with.\nIn our lua/jupyter/init.lua file, we create the following\n1 2 3 4 5 6 7 local M = {} function M.test() print(\"Calling From Jupyter Plugin!\") end return M Here we create a function called test our a table M. M is a common conventions in neovim plugins for storing the plugin api.\nIn our plugin/jupyter.lua file, we create the following\n1 2 3 4 5 6 7 8 9 10 if vim.g.loaded_jupyter then return end vim.g.loaded_jupyter = true -- Add any global commands or autocommands here vim.api.nvim_create_user_command(\"JupyterTest\", function() require(\"jupyter\").test() end, {}) Here we check if our plugin has already been loaded and exit if it has. Next, we create a neovim command called JupyterTest that will call our test function from our init.lua file.\nFinally, to regist our plugin, we need to add the following into our .config/nvim/lua/plugins/jupyter.lua into our lazyvim config. (Assuming you are using lazy as your plugin manager)\n1 2 3 4 5 6 7 return { dir = \"path/to/your/project/jupyter.nvim\", -- Your path name = \"jupyter\", config = function() require(\"jupyter\") end, } This will register our plugin with lazyvim. Finally, if we reload neovim, we should be able to run :JupyterTest and see the output of our test function.\nOur plugin is now working!\nConnecting to a Jupyter Server We will need to communicate with our Jupyter server using http and websockets. When you start a jupyter server, you will see an output similar to the following.\n1 Jupyter server running at http://127.0.0.1:8888/?token=abc123 The token query parameter is what we will need to authenticate with the server and create a kernel to run our code on.\nUsing our token we want to make the following http request.\n1 POST http://localhost:8888/api/kernels?token={{token}} And we should see something like the following in the body of our response.\n1 2 3 4 5 6 7 { \"id\": \"557fb118-3d4d-4703-b895-db1ee62b54a6\", \"name\": \"python3\", \"last_activity\": \"2025-02-20T04:15:06.379907Z\", \"execution_state\": \"starting\", \"connections\": 0 } This creates a kernel that we can connect to and run our code. What we need is the id of the kernel to later connect to the web socket endpoint. Let’s modify our init.lua file to create a function called connect\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 local M = {} function M.connect(token) if M.kernel ~= nil then print(\"Already connected\") return end if token == nil then print(\"Add token first\") return end local port = \"8888\" M.port = port M.token = token local curl = require(\"plenary.curl\") local response = curl.post(\"http://127.0.0.1:\" .. port .. \"/api/kernels?token=\" .. M.token, {}) if response.status ~= 201 then print(\"Error Connecting: \" .. response.body) M.token = nil M.port = nil return end M.kernel = vim.json.decode(response.body).id print(\"Connected to Jupyter Server. Kernel ID: \" .. M.kernel) end return M First, we want to abort if we already have a kernel id saved in our api table. Next, we check to make sure the user has provided a token. For the time being, we hard code the port to 8888, which we will later address. Since we need to make a post request, we will use the plenary.curl library. We make the post request, and send an error message to the user if we don’t get back the 201 created status code. Finally, we decode the reponse body and save the kernel id in our api table. If all went well, we print out a message to the user letting them know we were able to connect to the server.\nIn order to test our connection, we can create the JupyterConnect command in our plugin/jupyter.lua file.\n1 2 3 4 5 6 7 8 9 if vim.g.loaded_jupyter then return end vim.g.loaded_jupyter = true -- Add any global commands or autocommands here vim.api.nvim_create_user_command(\"JupyterConnect\", function(opts) require(\"jupyter\").connect(opts.args) end, { nargs = 1 }) We can reloade NeoVim and test our connection by running :JupyterConnect , and we should somthing like the following\nConnected to Jupyter Server. Kernel ID: 487257c8-d581-400b-b12e-1b2a9fd2a2b3\nAnd we have successfully connected to our Jupyter server from our lua plugin.\nSetting up a Websocket Connection ","wordCount":"938","inLanguage":"en","image":"http://localhost:1313/personal-blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-02-19T00:00:00Z","dateModified":"2025-02-19T00:00:00Z","author":{"@type":"Person","name":"Chase"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/personal-blog/posts/jupyter-neovim-plugin/"},"publisher":{"@type":"Organization","name":"Chase's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/personal-blog/static/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/personal-blog/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/personal-blog/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/personal-blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/personal-blog/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/personal-blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Creating a Jupyter Plugin for Neovim
<span class=entry-hint title=Draft><svg height="35" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h1><div class=post-meta><span title='2025-02-19 00:00:00 +0000 UTC'>February 19, 2025</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;938 words&nbsp;·&nbsp;Chase&nbsp;|&nbsp;<a href=https://github.com/acswindle/personal-blog/content/posts/jupyter-neovim-plugin/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#projet-setup>Projet Setup</a></li><li><a href=#connecting-to-a-jupyter-server>Connecting to a Jupyter Server</a></li><li><a href=#setting-up-a-websocket-connection>Setting up a Websocket Connection</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>I love NeoVim. However, there are times as a data scientist that I
really need the interactive experience of what Jupyter provides.
I have looked into various plugins for neovim, but none of them
seem to work at the level I would prefer. Whenever I find myself
in the need of an interactive environment, I end up opening
VSCode and using Jupyter interactively from my <code>.py</code> files using the
special <code>#%%</code> comment blocks.</p><p>Today, I decided to no longer keep this last thing from keeping me
from developing soley in neovim. Time to embark on my first NeoVim
plugin!</p><h2 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>#</a></h2><p>I want to make the requirements for this plugin initially as simple as possible.</p><ol><li>Connect to a Jupyter Server</li><li>Run the code contained within #%% blocks in the current buffer where
the cursor is currently located</li><li>Display the results in a new buffer and window.</li><li>Close the connection when the buffer is closed.</li></ol><p>I realize that this is a very simple plugin, but I want to make it as
simple as possible to get started.</p><h2 id=projet-setup>Projet Setup<a hidden class=anchor aria-hidden=true href=#projet-setup>#</a></h2><p>First, lets create a new directory called <code>jupyter-nvim</code> and create the
following structure.</p><p><img alt="file layout" loading=lazy src=/personal-blog/posts/jupyter-neovim-plugin/file-layout.png></p><p>Our <code>/lua/jupyter/init.lua</code> will contain the bulk of our plugin&rsquo;s code.
The <code>/plugin/jupyter.lua</code> contains the code we want neovim to execute
on startup. This will mostly be the vim commands we want to associate
with the function in our <code>init.lua</code> file.The <code>tests</code> directory will contain
some http testing files to test our connection with the Jupyter server and
some python files we can test our plugin with.</p><p>In our <code>lua/jupyter/init.lua</code> file, we create the following</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>M</span><span class=p>.</span><span class=nf>test</span><span class=p>()</span>
</span></span><span class=line><span class=cl> <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Calling From Jupyter Plugin!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>M</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we create a function called test our a table M.
M is a common conventions in neovim plugins for storing
the plugin api.</p><p>In our <code>plugin/jupyter.lua</code> file, we create the following</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>if</span> <span class=n>vim.g</span><span class=p>.</span><span class=n>loaded_jupyter</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl> <span class=kr>return</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>loaded_jupyter</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Add any global commands or autocommands here</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_create_user_command</span><span class=p>(</span><span class=s2>&#34;JupyterTest&#34;</span><span class=p>,</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;jupyter&#34;</span><span class=p>).</span><span class=n>test</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>,</span> <span class=p>{})</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we check if our plugin has already been loaded and exit if it has.
Next, we create a neovim command called <code>JupyterTest</code> that will call
our <code>test</code> function from our <code>init.lua</code> file.</p><p>Finally, to regist our plugin, we need to add the following into our
<code>.config/nvim/lua/plugins/jupyter.lua</code> into our lazyvim config.
(Assuming you are using lazy as your plugin manager)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>dir</span> <span class=o>=</span> <span class=s2>&#34;path/to/your/project/jupyter.nvim&#34;</span><span class=p>,</span> <span class=c1>-- Your path</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;jupyter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>require</span><span class=p>(</span><span class=s2>&#34;jupyter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This will register our plugin with lazyvim. Finally, if we reload neovim, we should
be able to run <code>:JupyterTest</code> and see the output of our <code>test</code> function.</p><p>Our plugin is now working!</p><h2 id=connecting-to-a-jupyter-server>Connecting to a Jupyter Server<a hidden class=anchor aria-hidden=true href=#connecting-to-a-jupyter-server>#</a></h2><p>We will need to communicate with our Jupyter server using http and websockets.
When you start a jupyter server, you will see an output similar to the following.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Jupyter server running at http://127.0.0.1:8888/?token<span class=o>=</span>abc123
</span></span></code></pre></td></tr></table></div></div><p>The token query parameter is what we will need to authenticate with the server
and create a kernel to run our code on.</p><p>Using our token we want to make the following http request.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST http://localhost:8888/api/kernels?token={{token}}
</span></span></span></code></pre></td></tr></table></div></div><p>And we should see something like the following in the body of our response.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;557fb118-3d4d-4703-b895-db1ee62b54a6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;python3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;last_activity&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-02-20T04:15:06.379907Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;execution_state&#34;</span><span class=p>:</span> <span class=s2>&#34;starting&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;connections&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This creates a kernel that we can connect to and run our code.
What we need is the id of the kernel to later connect to the web socket endpoint.
Let&rsquo;s modify our <code>init.lua</code> file to create a function called <code>connect</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>M</span><span class=p>.</span><span class=nf>connect</span><span class=p>(</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=kr>if</span> <span class=n>M.kernel</span> <span class=o>~=</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Already connected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span>
</span></span><span class=line><span class=cl> <span class=kr>end</span>
</span></span><span class=line><span class=cl> <span class=kr>if</span> <span class=n>token</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Add token first&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span>
</span></span><span class=line><span class=cl> <span class=kr>end</span>
</span></span><span class=line><span class=cl> <span class=kd>local</span> <span class=n>port</span> <span class=o>=</span> <span class=s2>&#34;8888&#34;</span>
</span></span><span class=line><span class=cl> <span class=n>M.port</span> <span class=o>=</span> <span class=n>port</span>
</span></span><span class=line><span class=cl> <span class=n>M.token</span> <span class=o>=</span> <span class=n>token</span>
</span></span><span class=line><span class=cl> <span class=kd>local</span> <span class=n>curl</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;plenary.curl&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=kd>local</span> <span class=n>response</span> <span class=o>=</span> <span class=n>curl.post</span><span class=p>(</span><span class=s2>&#34;http://127.0.0.1:&#34;</span> <span class=o>..</span> <span class=n>port</span> <span class=o>..</span> <span class=s2>&#34;/api/kernels?token=&#34;</span> <span class=o>..</span> <span class=n>M.token</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl> <span class=kr>if</span> <span class=n>response.status</span> <span class=o>~=</span> <span class=mi>201</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Error Connecting: &#34;</span> <span class=o>..</span> <span class=n>response.body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>M.token</span> <span class=o>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>  <span class=n>M.port</span> <span class=o>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span>
</span></span><span class=line><span class=cl> <span class=kr>end</span>
</span></span><span class=line><span class=cl> <span class=n>M.kernel</span> <span class=o>=</span> <span class=n>vim.json</span><span class=p>.</span><span class=n>decode</span><span class=p>(</span><span class=n>response.body</span><span class=p>).</span><span class=n>id</span>
</span></span><span class=line><span class=cl> <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Connected to Jupyter Server. Kernel ID: &#34;</span> <span class=o>..</span> <span class=n>M.kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>M</span>
</span></span></code></pre></td></tr></table></div></div><p>First, we want to abort if we already have a kernel id saved in our api table.
Next, we check to make sure the user has provided a token.
For the time being, we hard code the port to 8888, which we will later address.
Since we need to make a post request, we will use the <code>plenary.curl</code> library.
We make the post request, and send an error message to the user if we don&rsquo;t get back
the 201 created status code.
Finally, we decode the reponse body and save the kernel id in our api table.
If all went well, we print out a message to the user letting them know we were
able to connect to the server.</p><p>In order to test our connection, we can create the <code>JupyterConnect</code> command in our <code>plugin/jupyter.lua</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=hl><span class=lnt>7
</span></span><span class=hl><span class=lnt>8
</span></span><span class=hl><span class=lnt>9
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>if</span> <span class=n>vim.g</span><span class=p>.</span><span class=n>loaded_jupyter</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl> <span class=kr>return</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>loaded_jupyter</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Add any global commands or autocommands here</span>
</span></span><span class="line hl"><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_create_user_command</span><span class=p>(</span><span class=s2>&#34;JupyterConnect&#34;</span><span class=p>,</span> <span class=kr>function</span><span class=p>(</span><span class=n>opts</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;jupyter&#34;</span><span class=p>).</span><span class=n>connect</span><span class=p>(</span><span class=n>opts.args</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl><span class=kr>end</span><span class=p>,</span> <span class=p>{</span> <span class=n>nargs</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>We can reloade NeoVim and test our connection by running
<code>:JupyterConnect &lt;token></code>, and we should somthing like the following</p><p><code>Connected to Jupyter Server. Kernel ID: 487257c8-d581-400b-b12e-1b2a9fd2a2b3</code></p><p>And we have successfully connected to our Jupyter server from our lua plugin.</p><h2 id=setting-up-a-websocket-connection>Setting up a Websocket Connection<a hidden class=anchor aria-hidden=true href=#setting-up-a-websocket-connection>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/personal-blog/tags/neovim/>Neovim</a></li><li><a href=http://localhost:1313/personal-blog/tags/jupyter/>Jupyter</a></li><li><a href=http://localhost:1313/personal-blog/tags/plugin/>Plugin</a></li><li><a href=http://localhost:1313/personal-blog/tags/lua/>Lua</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/personal-blog/posts/ec2-hosting/><span class=title>« Prev</span><br><span>Hosting a Go Application on EC2</span>
</a><a class=next href=http://localhost:1313/personal-blog/posts/docker-image/><span class=title>Next »</span><br><span>Containerizing a Go Application</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on x" href="https://x.com/intent/tweet/?text=Creating%20a%20Jupyter%20Plugin%20for%20Neovim&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f&amp;hashtags=Neovim%2cJupyter%2cPlugin%2cLua"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f&amp;title=Creating%20a%20Jupyter%20Plugin%20for%20Neovim&amp;summary=Creating%20a%20Jupyter%20Plugin%20for%20Neovim&amp;source=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f&title=Creating%20a%20Jupyter%20Plugin%20for%20Neovim"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on whatsapp" href="https://api.whatsapp.com/send?text=Creating%20a%20Jupyter%20Plugin%20for%20Neovim%20-%20http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on telegram" href="https://telegram.me/share/url?text=Creating%20a%20Jupyter%20Plugin%20for%20Neovim&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating a Jupyter Plugin for Neovim on ycombinator" href="https://news.ycombinator.com/submitlink?t=Creating%20a%20Jupyter%20Plugin%20for%20Neovim&u=http%3a%2f%2flocalhost%3a1313%2fpersonal-blog%2fposts%2fjupyter-neovim-plugin%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/personal-blog/>Chase's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>